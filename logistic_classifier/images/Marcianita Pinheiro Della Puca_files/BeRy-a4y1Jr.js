/*!CK:1987718465!*//*1443564499,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["KanRJ"]); }

__d('PageVoiceDropdownSelector.react',['AdsAssetSectionType','AdsLoadState','AdsPageAssetSelector.react','BizSiteIdentifier.brands','BusinessAssetGrouping.brands','ContextualLayer.react','Image.react','ImageBlock.react','LayerAutoFocus','LayerHideOnBlur','LayerHideOnEscape','React','ReactDOM','ReactLayeredComponentMixin','XUIPopoverButton.react','underscore.ads','cx','emptyFunction','fbt','invariant','ix'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba){'use strict';if(c.__markCompiled)c.__markCompiled();var ca=s.PropTypes,da=300,ea=12,fa=s.createClass({displayName:'PageVoiceDropdownSelector',propTypes:{covered:ca.bool,permissions:ca.object,pages:ca.object.isRequired,selectedActorID:ca.string,showBusinessPages:ca.bool,showPersonalPageInRoot:ca.bool,showPageName:ca.bool,showUserInPersonalVoices:ca.bool,suppressed:ca.bool.isRequired,user:ca.object.isRequired,onChange:ca.func.isRequired,onClick:ca.func.isRequired},mixins:[u],getDefaultProps:function(){return {searchBarVisible:false,showBusinessPages:true,showPageName:false,showUserInPersonalVoices:true,covered:true};},getInitialState:function(){var ga=l.NULL_BIZ_ID;if(this.props.pages[this.props.selectedActorID]&&this.props.pages[this.props.selectedActorID].businessID)ga=""+this.props.pages[this.props.selectedActorID].businessID;var ha=ga;if(!k.isBizSite())ha=null;return {dialogShown:false,defaultBusinessID:ha,textDisplay:this._getActorName(this.props.selectedActorID),selectedActorID:this.props.selectedActorID,selectedBusinessID:ga,searchQuery:"",shownBusinessID:ha};},componentDidMount:function(){if(this.props.focusOnInit&&this.refs['open-menu-button'])t.findDOMNode(this.refs['open-menu-button']).focus();},componentWillReceiveProps:function(ga){this.setState({selectedActorID:ga.selectedActorID});},componentWillUnmount:function(){this.setState=y;},renderLayers:function(){return {contextualDialog:s.createElement(m,{alignment:'right',behaviors:{LayerAutoFocus:p,LayerHideOnBlur:q,LayerHideOnEscape:r},contextRef:(function(){return this.refs['open-menu-button'];}).bind(this),position:'below',shown:this.state.dialogShown,onToggle:this._onToggle},this._renderLayerContent())};},render:function(){return (s.createElement(v,{className:"_4z8-",haschevron:!this.props.covered,image:s.createElement(n,{width:16,height:16,src:this.props.covered?ba('images/pages/voice/flag.png'):this._getSelectedImageSource()}),label:this.props.showPageName?this._getSelectedActorName():"",ref:'open-menu-button',suppressed:this.props.suppressed,type:'button',onClick:this._onButtonClick}));},_renderLayerContent:function(){if(w.isEmpty(this.props.user))return null;var ga=this._getPageSelectorPages(),ha=null;if(this.props.selectedActorID===this.props.user.id)ha=s.createElement('div',{className:"_55fc"});var ia=null;if(this.props.user.id&&(this.state.shownBusinessID===l.NULL_BIZ_ID||this.state.shownBusinessID===null&&this.props.showUserInPersonalVoices))ia=s.createElement(o,{className:"_5dsl"+(' '+"_alf")+(this.props.selectedActorID===this.props.user.id?' '+"_2246":'')+(' '+"_alg"),onClick:(function(){this._updateSelectedActor(this.props.user.id);}).bind(this)},s.createElement(n,{className:"_4-rj",width:30,height:30,src:this.props.user.thumbSrc}),s.createElement('div',{className:"_1wcv"},s.createElement('div',{className:"_2sl4"+(' '+"_4c71")},this.props.user.name,'Â ',s.createElement('span',{className:"_uyb"},z._("(Voc\u00ea)")),ha)));return s.createElement('div',{className:"_21wq"+(' '+"_70b")},ia,ga.length===0?null:s.createElement(j,{bookmarkedPages:[],compactLayout:true,listItemHoverStyle:"dark-blue",maxListHeight:da,pages:ga,searchedPages:[],searchQuery:this.state.searchQuery,searchState:i.NOT_LOADED,selectedPageID:this.props.selectedActorID,selectedBusinessID:this.state.selectedBusinessID,selectedSectionType:h.OWNED,showBookmarks:false,showBottomBorder:false,showBusinessPages:this.props.showBusinessPages,showNonBizGroupTitle:true,showPageCount:false,showPersonalPagesInRoot:this.props.showPersonalPagesInRoot||false,showSectionPageCount:true,shownBusinessID:this.state.shownBusinessID,sortPages:false,unownedPages:[],onBusinessSelected:this._onBusinessSelected,onPageSelected:this._onPageSelected,onPageRemoved:function(){},onPageBookmarked:function(){},onSearch:this._onSearch,searchBarVisible:ga.length>=ea}));},_onBusinessSelected:function(ga){this.setState({shownBusinessID:ga});},_onPageSelected:function(ga,ha,ia){this.setState({selectedBusinessID:ha},(function(){return this._updateSelectedActor(ga);}).bind(this));},_onSearch:function(ga){this.setState({searchQuery:ga});},_onButtonClick:function(){this.setState({dialogShown:!this.state.dialogShown,shownBusinessID:this.state.defaultBusinessID},this.props.onClick);},_onToggle:function(ga){this.setState({dialogShown:ga});},_getSelectedImageSource:function(){var ga=this.state.selectedActorID;if(!ga)return "";if(ga===this.props.user.id){if(!this.props.user.thumbSrc)return "";return this.props.user.thumbSrc;}else{if(!this.props.pages[ga].thumbSrc)return "";return this.props.pages[ga].thumbSrc;}},_getSelectedActorName:function(){var ga=this.state.selectedActorID;if(!ga)return "";if(ga===this.props.user.id){if(!this.props.user.name)return "";return this.props.user.name;}else{if(!this.props.pages[ga].name)return "";return this.props.pages[ga].name;}},_getPageSelectorPages:function(){var ga=w.map(this.props.pages,function(ha,ia){var ja={id:ia,name:ha.name,picture:{data:{url:ha.thumbSrc}},userpermissions:{data:[]},sectionType:h.OWNED};if(ha.allBusinessData)ha.allBusinessData.forEach(function(ka){if(ka.businessID)ja.userpermissions.data.push({business:{name:ka.businessName,id:ka.businessID}});});return ja;},this);if(this.props.user.id){!(ga[0].id===this.props.user.id)?aa(0):undefined;return ga.slice(1);}return ga;},_getActorName:function(ga){if(ga===this.props.user.id){return this.props.user.name;}else return this.props.pages[ga].name;},_updateSelectedActor:function(ga){if(!ga||ga===this.state.selectedActorID)return;this.setState({selectedActorID:ga,dialogShown:false,searchQuery:""});if(ga===this.props.user.id){this.setState({textDisplay:this.props.user.name});this.props.onChange({label:this.props.user.name,value:this.props.user.id});}else{this.setState({textDisplay:this.props.pages[ga].name});this.props.onChange({label:this.props.pages[ga].name,value:ga});}}});f.exports=fa;},null);