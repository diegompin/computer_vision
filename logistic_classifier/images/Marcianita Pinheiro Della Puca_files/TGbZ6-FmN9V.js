/*!CK:1583419243!*//*1443564744,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["clunI"]); }

__d('canUseReactEditor',['UserAgent'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=typeof b.getSelection==='function',j=i&&((h.isPlatform('iOS')||h.isPlatform('Linux')||h.isPlatform('Mac OS X')||h.isPlatform('Windows')||h.isPlatform('Chrome OS'))&&(h.isBrowser('Chrome')||h.isBrowser('Edge >= 12')||h.isBrowser('Firefox >= 16')||h.isBrowser('IE >= 9')||h.isBrowser('Opera >= 12')||h.isBrowser('Mobile Safari >= 6')||h.isBrowser('Safari >= 5')));function k(){return j;}f.exports=k;},null);
__d('applyEmoticonToContentBlock',['CharacterMetadata','DocumentEntity','EmoticonsList','immutable'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=k.List,m='\u3000';function n(o,p,q){if(!j.emotes[p])return o;var r=i.create('EMOTICON','IMMUTABLE',{type:j.emotes[p],originalEmoticon:p}),s=o.getText(),t=o.getCharacterList(),u=p.length,v=t.get(q);return o.merge({text:s.slice(0,q)+m+s.slice(q+u),characterList:t.slice(0,q).concat(l.of(h.applyEntity(v,r)),t.slice(q+u))});}f.exports=n;},null);
__d('getTextAfterNearestEntity',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j){var k=j;while(k>0&&i.getEntityAt(k-1)===null)k--;return i.getText().slice(k,j);}f.exports=h;},null);
__d('applyEmoticonToContentState',['EmoticonsList','applyEmoticonToContentBlock','getTextAfterNearestEntity'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=new RegExp(h.regexp.source,'g');function l(m,n){var o=n.getAnchorKey(),p=n.getAnchorOffset(),q=m.getBlockForKey(o),r=j(q,p),s,t;while(t!==null){t=k.exec(r);if(t!==null)s=t;}if(!s)return m;var u=s[1];if(!u&&p!==r.length)return m;var v=s[2],w=p-r.length,x=w+s.index+s[1].length,y=m.getBlockMap().set(o,i(q,v,x));p-=v.length-1;return m.merge({blockMap:y,selectionBefore:n,selectionAfter:n.merge({anchorOffset:p,focusOffset:p})});}f.exports=l;},null);
__d('handleBeforeInputForEmoticon',['DraftModifier','EditorState','applyEmoticonToContentState'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=new RegExp(/[\s'".,!?]/);function l(m,n){var o=m.getSelection();if(!o.isCollapsed()||!n||!k.test(n))return m;var p=m.getCurrentContent(),q=j(p,o);if(q===p)return m;var r=h.insertText(q,q.getSelectionAfter(),n);return i.push(m,r,'insert-characters');}f.exports=l;},null);
__d('handleSoftNewlineForEmoticon',['DraftModifier','EditorState','applyEmoticonToContentState'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(l){var m=l.getCurrentContent(),n=l.getSelection(),o=j(m,n);if(o===m)return l;var p=h.splitBlock(o,o.getSelectionAfter());return i.push(l,p,'split-block');}f.exports=k;},null);
__d('isSoftNewlineEvent',['Keys'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(j){return j.which===h.RETURN&&(j.getModifierState('Shift')||j.getModifierState('Alt')||j.getModifierState('Control'));}f.exports=i;},null);
__d('UFIMentionsInput.react',['Arbiter','BanzaiScuba','Bootloader','DocumentEntity','DraftModifier','DOMVector','EditorState','Input','Keys','MentionsInput.react','React','ReactDOM','SelectionState','UFIUIEvents','URI','canUseReactEditor','clickRefAction','createEditorStateWithEntities','createMentionEntity','cx','emptyFunction','getMentionsInputDecorator','getMentionsTextForContentState','getVisibleValueForContentState','handleBeforeInputForEmoticon','handleSoftNewlineForEmoticon','isSoftNewlineEvent','setImmediate'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia){if(c.__markCompiled)c.__markCompiled();var ja=new i('ufi_tinder',null,{addBrowserFields:true,addGeoFields:true,addPredictedGeographyFields:true,addMobileDeviceFields:true,addUser:true}),ka=200,la='ufi_comment_composer',ma='ufi_reply_composer',na=w();function oa(sa){var ta=sa.map(function(ua){return {kind:'file',type:ua.type,getAsFile:ba.thatReturns(ua)};});return {clipboardData:{items:ta}};}function pa(sa){var ta=/^image\//;return sa.filter(function(ua){return ta.test(ua.type);});}var qa=r.createClass({displayName:'UFIMentionsInput',getInitialState:function(){var sa='',ta=[];if(this.props.initialData){sa=this.props.initialData.value||'';ta=this.props.initialData.mentions||[];ta=ta.map(function(va){return babelHelpers._extends({},va,{entity:{uid:va.uid,weakreference:va.weakreference}});});}var ua=y({text:sa,ranges:ta,decorator:ca(),entityCreationFn:ra});ua=n.moveSelectionToEnd(ua);return {bootloaded:false,fullRender:!!(this.props.initialData&&this.props.initialData.value),typeaheadReporter:null,editorState:ua,mentionsSource:null,mentionableEntries:null,fallbackText:sa};},hasEnteredText:function(){return !!this.state.editorState.getCurrentContent().getPlainText().trim();},focus:function(){this._triggerFullRender((function(){if(na){this.refs.mentionsInput.focus();}else s.findDOMNode(this.refs.textarea).focus();}).bind(this));},submitComment:function(event){if(this._submitComment(event))this._clearDocumentState();},insertMention:function(sa){this._triggerFullRender((function(){if(na){var ta=this.state.editorState,ua=ta.getSelection(),va=ta.getCurrentContent(),wa=ua.getStartKey(),xa=ua.getStartOffset(),ya=va.getBlockForKey(wa),za;if(ya.getText().substr(xa-1,1).trim().length>0){var ab=l.replaceText(va,ua,' ');ua=ab.getSelectionAfter();za=l.insertText(ab,ua,sa.getTitle(),ta.getCurrentInlineStyle(),z(sa));}else za=l.replaceText(va,ua,sa.getTitle(),ta.getCurrentInlineStyle(),z(sa));ua=za.getSelectionAfter();za=l.insertText(za,ua,' ');ta=n.push(ta,za,'insert-fragment');ta=n.forceSelection(ta,ta.getSelection());this.setState({editorState:ta});this.focus();}else{s.findDOMNode(this.refs.textarea).focus();if(this.state.fallbackText.length){this.setState({fallbackText:this.state.fallbackText+' '+sa.title});}else this.setState({fallbackText:sa.title});}}).bind(this));},insertEmoticon:function(sa){if(!na){this.setState({fallbackText:this.state.fallbackText+' '+sa});return;}var ta=this.state.editorState,ua=ta.getCurrentContent(),va=ta.getSelection(),wa=ua.getBlockForKey(va.getStartKey()).getText()[va.getStartOffset()-1];if(wa&&wa!==' ')sa=' '+sa;var xa=ua.getBlockForKey(va.getEndKey()).getText()[va.getEndOffset()];if(xa&&xa!==' ')sa+=' ';var ya=l.replaceText(ta.getCurrentContent(),ta.getSelection(),sa);ta=n.push(ta,ya,'insert-characters');ta=n.forceSelection(ta,ta.getSelection());this.setState({editorState:ta});},setSignature:function(sa){setTimeout((function(){var ta=this.state.editorState,ua=ta.getSelection(),va=ta.getCurrentContent(),wa=va.getBlockMap().first(),xa=wa.getKey();ua=new t({anchorKey:xa,anchorOffset:0,focusKey:xa,focusOffset:sa.length});va=l.replaceText(va,ua,sa);ta=n.set(ta,{currentContent:va});this.setState({editorState:ta});}).bind(this),0);},_informHeightChange:function(){if(this.props.monitorHeight)ia((function(){if(!this.isMounted())return;var sa=na?s.findDOMNode(this.refs.mentionsInput):s.findDOMNode(this.refs.textarea),ta=m.getElementDimensions(sa).y;if(ta!==this._height){this._height=ta;h.inform(u.InputHeightChanged,{node:sa});}}).bind(this));},_onChange:function(sa){this.setState({editorState:sa},this._informHeightChange);},_clearDocumentState:function(){this.state.typeaheadReporter&&this.state.typeaheadReporter.sessionEnd();var sa=n.createEmpty(ca());this.setState({editorState:n.moveFocusToEnd(sa)});},_handleContentReturn:function(sa){if(ha(sa)){var ta=ga(this.state.editorState);if(ta===this.state.editorState){return false;}else{this.setState({editorState:ta});return true;}}if(this._submitComment(sa)){this._clearDocumentState();return true;}return false;},_handleBeforeInput:function(sa){var ta=fa(this.state.editorState,sa);if(ta===this.state.editorState){return false;}else{this.setState({editorState:ta});return true;}},_submitComment:function(sa){var ta=this.state.editorState.getCurrentContent(),ua=ea(ta),va=da(ta),wa={visibleValue:ua,encodedValue:va},xa=o.getValue(s.findDOMNode(this.refs.proxyInput));if(xa){var ya=new v(b.location.href);ja.addNormal('path',ya.getPath());ja.addNormal('proxy_value',xa.substr(0,ka));ja.post();}return this.props.onEnterSubmit(wa,sa);},_handleFiles:function(sa){var ta=pa(sa);if(ta.length){this.props.onPaste(oa(ta));return true;}return false;},_handleDroppedFiles:function(sa,ta){return this._handleFiles(ta);},_handlePastedFiles:function(sa){return this._handleFiles(sa);},_onMentionsInputBlur:function(){this.state.typeaheadReporter&&this.state.typeaheadReporter.sessionEnd();this.props.onBlur&&this.props.onBlur();h.inform(u.Blur,{hasEnteredText:this.hasEnteredText()});},_onMentionsInputFocus:function(){if(!this.state.bootloaded&&!this._currentlyBootloading){this._currentlyBootloading=true;if(this.props.showBusinessTypeahead){j.loadModules(["TypeaheadMetricReporter","getBusinessMentionsSearchSource"],(function(sa,ta){if(!this.isMounted())return;var ua=new sa({event_name:'tinder_mentions'});ua.sessionStart();var va=ta(ua,this.props.ftEntIdentifier);va.bootstrap();this.setState({typeaheadReporter:ua,bootloaded:true,mentionsSource:va},(function(){this._currentlyBootloading=false;}).bind(this));}).bind(this));}else j.loadModules(["TypeaheadMetricReporter","getMentionsSearchSource"],(function(sa,ta){if(!this.isMounted())return;var ua=new sa({event_name:'tinder_mentions'});ua.sessionStart();var va=ta(this.props.datasource,ua,this.props.showHashtagTypeahead);va.bootstrap();this.setState({typeaheadReporter:ua,bootloaded:true,mentionsSource:va},(function(){this._currentlyBootloading=false;}).bind(this));}).bind(this));}else if(this.state.typeaheadReporter)this.state.typeaheadReporter.sessionStart();this.props.onFocus&&this.props.onFocus();h.inform(u.Focus);},_onShowMentions:function(sa,ta){if(this.state.typeaheadReporter)this.state.typeaheadReporter.reportResults(sa.map(function(ua){return ua.getUniqueID();}));},_onAddMention:function(sa,ta,ua){if(this.state.typeaheadReporter){this.state.typeaheadReporter.reportSelect(sa.getUniqueID(),sa.getType(),ta,ua.button>=0);this.state.typeaheadReporter.sessionEnd();this.state.typeaheadReporter.sessionStart();}},_onFallbackKeyDown:function(sa){if(sa.which!==p.RETURN)return;if(ha(sa)||!this.state.fallbackText.trim())return;sa.preventDefault();var ta={visibleValue:this.state.fallbackText,encodedValue:this.state.fallbackText};if(this.props.onEnterSubmit(ta,sa))this.setState({fallbackText:''});},_onFallbackChange:function(sa){this.setState({fallbackText:sa.target.value});},_onFallbackBlur:function(sa){this.props.onBlur&&this.props.onBlur();},_onFallbackFocus:function(sa){this.props.onFocus&&this.props.onFocus();},_sortByRenderType:function(sa,ta){var ua=sa.getAuxiliaryData().renderType,va=ta.getAuxiliaryData().renderType;if(ua===va)return sa.getOrder()-ta.getOrder();var wa=this.props.viewOptionsTypeObjectsOrder;return wa.indexOf(ua)-wa.indexOf(va);},_triggerFullRender:function(sa){this.setState({fullRender:true},sa);},_triggerFullRenderWithoutCallback:function(){this._triggerFullRender();},_renderFallback:function(){return (r.createElement('div',null,r.createElement('textarea',{ref:'textarea',className:"UFIAddCommentInput _1os9",name:'add_comment_text',placeholder:this.props.placeholder,spellCheck:true,onKeyDown:this._onFallbackKeyDown,onChange:this._onFallbackChange,onBlur:this._onFallbackBlur,onFocus:this._onFallbackFocus,value:this.state.fallbackText})));},_renderProxyInput:function(){if(!this.props.hideProxyInput){var sa="_1osa mentionsHidden";return (r.createElement('input',{className:sa,name:'add_comment_text',ref:'proxyInput',onFocus:this.focus,tabIndex:'-1'}));}},_renderDummy:function(){var sa="UFIAddCommentInput _1osb _1osc";return (r.createElement('div',{onFocus:this._triggerFullRenderWithoutCallback,onSelect:ba,onClick:this._triggerFullRenderWithoutCallback,onTouchStart:this._triggerFullRenderWithoutCallback,onMouseOver:this._triggerFullRenderWithoutCallback},this._renderProxyInput(),r.createElement('div',{className:sa},this.props.placeholder)));},_onClickEditorContainer:function(sa){x('ufi',sa.target,null,'FORCE');},_renderMentionsInput:function(){var sa="UFIAddCommentInput _1osb",ta=babelHelpers._extends({mentionSortFn:this.props.viewOptionsTypeObjectsOrder?this._sortByRenderType:null},this.props.viewProps);return (r.createElement('div',{onClick:this._onClickEditorContainer},this._renderProxyInput(),r.createElement(q,{ref:'mentionsInput',className:sa,editorState:this.state.editorState,onChange:this._onChange,mentionsSource:this.state.mentionsSource,typeaheadView:this.props.viewComponent,typeaheadViewProps:ta,spellCheck:true,placeholder:this.props.placeholder,onAddMention:this._onAddMention,onShowMentions:this._onShowMentions,onFocus:this._onMentionsInputFocus,onBlur:this._onMentionsInputBlur,handleContentReturn:this._handleContentReturn,handleBeforeInput:this._handleBeforeInput,handlePastedFiles:this._handlePastedFiles,handleDroppedFiles:this._handleDroppedFiles,autoflip:this.props.autoflip,webDriverTestID:this.props.replyCommentID?ma:la})));},componentDidMount:function(){if(!na){if(this.state.fallbackText)s.findDOMNode(this.refs.textarea).focus();}else if(this.state.editorState.getCurrentContent().hasText())ia((function(){this.isMounted()&&this.focus();}).bind(this));},render:function(){if(!na)return this._renderFallback();if(!this.state.fullRender)return this._renderDummy();return this._renderMentionsInput();}});function ra(sa){return k.create('MENTION','IMMUTABLE',{id:sa.uid,isWeak:sa.weakreference});}f.exports=qa;},null);